/**
 * fsm.ai v0.1.0
 * (c) 2019 Pengfei Wang
 * @license MIT
 */
var t,e;t=this,e=function(){"use strict";function t(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}var e="fsm_autoc_",n="fsm-list-item",o=28,i=5,r=1,s="",a=function(t,e){"string"==typeof t&&(t=document.querySelectorAll(t)),this.options=e,this.elements=t,this.parElement=t.parentNode;var n=e.hoverClass;void 0===n&&(n="fsm-item-selected"),this.hoverClass=n,this._initUIEvent();for(var o=0;o<this.elements.length;o++)this._initKeyupEvent(this.elements[o])};function l(t,n){if(!n){var o=document.body.querySelector('[autoComplete="true"]');o&&(n=o)}if(n&&n.id){var i=e+n.id,r=document.body.querySelector("#"+i);r&&(r.style.display="none",n.removeAttribute("autoComplete"))}}function u(t,e,n){t.value=t.value.substring(0,n)+e+t.value.substring(n,t.value.length)}function d(t){if(!Array.isArray(t))return"";var e,o,i="<ul>";return e=t,o=function(t,e){i+='\n            <li index="'+e+'" class="'+n+'">'+t+"</li>\n        "},Object.keys(e).forEach(function(t){return o(e[t],t)}),i+="</ul>"}a.prototype._initUIEvent=function(){var e=this,o=document.body;t(o,"mouseover",function(t){for(var i=t.target;i!==o;){if(i.classList.contains(n)){i.classList.add(e.hoverClass);break}i=i.parentNode}}),t(o,"mouseout",function(t){for(var i=t.target;i!==o;){if(i.classList.contains(n)){i.classList.remove(e.hoverClass);break}i=i.parentNode}}),t(o,"click",function(t){for(var e=t.target,n=!0;e!==o;){if(e.classList.contains("fsm-auto-complete")){n=!1;break}e=e.parentNode}n&&l()})},a.prototype._initKeyupEvent=function(a){var c=this,f=this.options,p=f.isServer;void 0===p&&(p=!1);var v=f.url;void 0===v&&(v="");var m=f.method;void 0===m&&(m="get");var h=f.param;void 0===h&&(h={});var y=f.identity;void 0===y&&(y="_");var g=f.data;void 0===g&&(g=[]);var b=f.trigger;void 0===b&&(b="."),s=b,console.log("elem",a),t(a,"keyup",function(f){if(f.which>=37&&f.which<=40||13===f.which)return c._initKeyArrowEvent(a,f.which),!1;var p=a.value;if(void 0!==a.selectionStart)(function(t,e){if(e>=t.length)return t;for(var n=t.split(" "),o=0,i=t,r=0;r<n.length;r++){var s=n[r];if((o+=s.length+1)>e){i=s;break}}})(p,a.selectionStart);var v=p.split(" ").pop();if(-1!==v.indexOf(b)){var m=v.split(b),h=m[0],y=m[1];if(/[^a-zA-Z_\s]/g.test(h)||/[^a-zA-Z_]/g.test(y))a.hasAttribute("autoComplete")&&l();else{var x=function(t,e){if(!Array.isArray(t))return[];if(""===e)return t;for(var n=[],o=0;o<t.length;o++)if("string"==typeof e){var i=new RegExp(e).exec(t[o]);null!=i&&i.index>-1&&n.push(t[o])}return n}(g,y);if(x.length){var C=a.getBoundingClientRect(),E=function(t){var e=document.getElementById("preFC");e||((e=document.createElement("pre")).id="preFC");t.getBoundingClientRect();e.innerText=t.value,e.style.display="initial",e.style.position="absolute",e.style["font-size"]=window.getComputedStyle(t)["font-size"],e.style["font-family"]=window.getComputedStyle(t)["font-family"],e.style.opacity="0",document.body.appendChild(e);var n=e.offsetWidth,o=e.offsetHeight;return e.remove(),{width:n,height:o}}(a),w={x:4,y:4},A={x:C.left+Math.min(E.width,C.width)+w.x,y:C.top+Math.min(E.height,C.height)+w.y};!function(a,c,f,p){console.log(">>>showAutoComplete...",p),c.id||(c.id="ran"+r,r+=1);var v=e+c.id,m=document.body.querySelector("#"+v);m?m.innerHTML=d(f):(function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML="\n\t\tul,li{\n\t\t\tlist-style: none;\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t\t.fsm-auto-complete {\n\t\t\tposition: absolute;\n\t\t\tbackground: #fff;\n\t\t\twidth: 200px;\n\t\t\tborder: 1px solid #dedede;\n\t\t\tborder-radius: 3px;\n\t\t\tmax-height: "+(o*i+2)+"px;\n    \t\toverflow: auto;\n\t\t}\n\t\t.fsm-auto-complete ul {\n\t\t\tpadding: 1px;\n\t\t\tfont-size: 14px;\n\t\t}\n\t\t.fsm-auto-complete ."+n+" {\n\t\t\tborder-bottom: 1px solid #dedede;\n\t\t\tpadding: 4px;\n\t\t}\n\t\t.fsm-auto-complete ."+n+":first-child {\n\t\t\tborder-radius: 3px 3px 0 0;\n\t\t}\n\t\t.fsm-auto-complete ."+n+":last-child {\n\t\t\tborder-bottom: none;\n\t\t\tborder-radius: 0 0 3px 3px;\n\t\t}\n\t\t.fsm-auto-complete ."+t.hoverClass+" {\n\t\t\tbackground: #007CEE;\n\t\t\tcolor: #fff;\n\t\t\tcursor: default;\n\t\t}\n\t",document.body.children[0].before(e)}(a),(m=document.createElement("div")).classList.add("fsm-auto-complete"),m.id=v,m.innerHTML=d(f),document.body.append(m),function(e,o){t(o,"click",function(t){for(var i=t.target;i!==o;){if(i.classList.contains(n)){if(e.value=e.value.replace(/[\r\n]$/g,""),void 0!==e.selectionStart){var r=e.selectionStart;u(e,i.innerText,r)}else{var a=e.value,d=a.split(s);d.pop(),d.push(i.innerText),e.value=d.join(s)}l(),e.focus();break}i=i.parentNode}})}(c,m));m.style.display="block",c.setAttribute("autoComplete",!0),p&&(p.x&&(m.style.left=p.x+"px"),p.y&&(m.style.top=p.y+"px"))}(c,a,x,A)}else l()}}else a.hasAttribute("autoComplete")&&l()})},a.prototype._initKeyArrowEvent=function(t,r){if(t.hasAttribute("autoComplete")){var s=e+t.id,a=document.body.querySelector("#"+s);if(a){var l=a.querySelectorAll("."+n),u=0,d=a.querySelector("."+this.hoverClass);if(13===r)return void d.click();38===r?(d&&(u=parseInt(d.getAttribute("index"))-1)<0&&(u=0),a.scroll({top:o*(u-i+1)})):40===r&&(d&&(u=parseInt(d.getAttribute("index"))+1)>l.length-1&&(u=l.length-1),a.scroll({top:o*(u-i+1)}));var c=l[u];d&&d.classList.remove("fsm-item-selected"),c.classList.add("fsm-item-selected")}}};var c=function(){};return c.intellisense=function(t,e){return new a(t,e)},c},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Fsm=e();